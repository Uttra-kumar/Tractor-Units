<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tractor - Advanced Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6c5ce7;
            --secondary: #a29bfe;
            --accent: #fd79a8;
            --success: #00b894;
            --warning: #fdcb6e;
            --info: #74b9ff;
            --dark: #2d3436;
            --light: #f5f6fa;
            --card-bg: #ffffff;
            --header-bg: #ffffff;
            --text-color: #2d3436;
            --card-shadow: 0 10px 30px rgba(108, 92, 231, 0.15);
            --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            --header-height: 80px;
            --menu-height: 70px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background: var(--light);
            color: var(--text-color);
            min-height: 100vh;
            overflow-x: hidden;
            transition: var(--transition);
        }
        
        /* Header Styles */
        .header {
            background: var(--header-bg);
            color: var(--text-color);
            padding: 0 30px;
            height: var(--header-height);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-size: 24px;
            font-weight: 700;
        }
        
        .logo i {
            margin-right: 12px;
            color: var(--secondary);
        }
        
        .time-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(0, 0, 0, 0.05);
            padding: 10px 20px;
            border-radius: 12px;
            transition: var(--transition);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }
        
        #current-time {
            font-size: 20px;
            font-weight: 600;
            letter-spacing: 1px;
        }
        
        #current-date {
            font-size: 15px;
            color: var(--text-color);
            font-weight: bold;
        }
        
        .admin-info {
            display: flex;
            align-items: center;
            position: relative;
        }
        
        .admin-details {
            line-height: 1.3;
        }
        
        .admin-details h3 {
            font-size: 16px;
            font-weight: 600;
        }
        
        .admin-details p {
            font-size: 12px;
            color: var(--text-color);
        }
        
        /* Horizontal Menu */
        .horizontal-menu {
            background: var(--header-bg);
            margin-top: var(--header-height);
            padding: 0 30px;
            display: flex;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 999;
            height: var(--menu-height);
            transition: var(--transition);
            overflow-x: auto;
            white-space: nowrap;
        }
        
        .menu-item {
            padding: 0 25px;
            display: flex;
            align-items: center;
            transition: var(--transition);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            position: relative;
            overflow: hidden;
            height: 100%;
            text-decoration: none;
            color: var(--text-color);
        }
        
        .menu-item.active {
            background: rgba(108, 92, 231, 0.1);
            border-bottom: 3px solid var(--secondary);
        }
        
        .menu-item:hover {
            border-bottom: 3px solid var(--secondary);
        }
        
        .menu-item i {
            margin-right: 10px;
            font-size: 18px;
            color: var(--primary);
        }
        
        .menu-item span {
            font-size: 15px;
            font-weight: 500;
            color: var(--text-color);
        }
        
        .logout {
            margin-left: auto;
            display: flex;
            align-items: center;
            color: var(--accent);
            cursor: pointer;
            padding: 0 25px;
            transition: var(--transition);
            height: 100%;
        }
        
        .logout:hover {
            background: rgba(253, 121, 168, 0.1);
        }
        
        .logout i {
            margin-right: 10px;
            font-size: 18px;
        }
        
        .logout span {
            font-size: 15px;
            font-weight: 500;
        }
        
        /* Main Content */
        .main-content {
            margin-top: calc(var(--header-height) + var(--menu-height));
            padding: 30px;
            transition: var(--transition);
        }
        
        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .dashboard-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .dashboard-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .dashboard-header p {
            color: var(--dark);
            font-size: 1.1rem;
        }
        
        .section-title {
            font-size: 1.5rem;
            margin: 30px 0 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .section-title i {
            margin-right: 10px;
        }
        
        /* Quick Access Grid */
        .quick-access-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .quick-access-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Card Styles */
        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(108, 92, 231, 0.1);
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
        }
        
        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }
        
        .card-full {
            grid-column: 1 / -1;
        }
        
        .card-highlight {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }
        
        .card-highlight::before {
            display: none;
        }
        
        .card-highlight .card-icon {
            color: white;
        }
        
        .card-highlight .card-title {
            color: white;
        }
        
        .card-highlight .card-description {
            color: rgba(255, 255, 255, 0.8);
        }
        
        .card-link {
            display: block;
            text-decoration: none;
            color: inherit;
            height: 100%;
        }
        
        .card-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .card-title {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--text-color);
            font-weight: 600;
        }
        
        .card-description {
            color: #7f8c8d;
            margin-bottom: 20px;
            flex-grow: 1;
        }
        
        .card-access {
            display: inline-flex;
            align-items: center;
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            margin-top: auto;
        }
        
        .card-access i {
            margin-left: 5px;
            transition: var(--transition);
        }
        
        .card:hover .card-access {
            color: var(--secondary);
        }
        
        .card:hover .card-access i {
            transform: translateX(5px);
        }
        
        .card-highlight .card-access {
            color: white;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 25px;
        }
        
        .card-highlight .card-access:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Stats Section */
        .stats-section {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stats-column {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--card-shadow);
        }
        
        .stats-column-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid;
            display: flex;
            align-items: center;
        }
        
        .stats-column-title i {
            margin-right: 10px;
        }
        
        .fleet-stats .stats-column-title {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        .trolley-stats .stats-column-title {
            color: var(--success);
            border-bottom-color: var(--success);
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .stat-item:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            display: flex;
            align-items: center;
            font-weight: 500;
        }
        
        .stat-label i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .stat-value {
            font-weight: 700;
            font-size: 1.2rem;
        }
        
        .fleet-stats .stat-value {
            color: var(--primary);
        }
        
        .trolley-stats .stat-value {
            color: var(--success);
        }
        
        /* Recent Activity Section */
        .recent-activities {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .activity-column {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--card-shadow);
        }
        
        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .activity-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.03);
            border-radius: 10px;
            transition: var(--transition);
        }
        
        .activity-item:hover {
            background: rgba(0, 0, 0, 0.06);
            transform: translateX(5px);
        }
        
        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 16px;
            color: white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .activity-details {
            flex: 1;
        }
        
        .activity-details h4 {
            font-size: 16px;
            margin-bottom: 5px;
            color: var(--text-color);
        }
        
        .activity-details p {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 0;
        }
        
        .activity-time {
            font-size: 12px;
            color: var(--text-color);
        }
        
        /* Divider */
        .divider {
            display: flex;
            align-items: center;
            margin: 40px 0;
            color: var(--dark);
        }
        
        .divider-line {
            flex-grow: 1;
            height: 2px;
            background: var(--primary);
        }
        
        .divider-text {
            padding: 0 20px;
            font-weight: 600;
            font-size: 1.2rem;
        }
        
        /* Footer */
        footer {
            background: var(--dark);
            color: white;
            padding: 1.5rem 0;
            margin-top: 25px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            text-align: center;
        }
        
        footer p {
            color: #ecf0f1;
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }
        
        footer span {
            color: var(--accent);
            font-weight: 600;
        }
        
        #counter {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            background: linear-gradient(45deg, var(--accent), var(--secondary));
            color: white;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(253, 121, 168, 0.4);
            animation: pulse 2s infinite;
            margin-left: 0.25rem;
        }
        
        p1 {
            font-size: 1.2rem;
            color: #ecf0f1 !important;
            display: inline-block;
            background: rgba(0, 0, 0, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 5px;
        }
        
        /* Loading Animation */
        .loading {
            animation: pulse 1.5s infinite;
            background: #f0f0f0;
            color: transparent;
            border-radius: 4px;
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        
        /* Colorful Icons */
        .icon-database { color: #6c5ce7; }
        .icon-users { color: #00b894; }
        .icon-file { color: #fd79a8; }
        .icon-filter { color: #fdcb6e; }
        .icon-truck { color: #74b9ff; }
        .icon-sliders { color: #a29bfe; }
        .icon-wallet { color: #e17055; }
        .icon-dolly { color: #00cec9; }
        .icon-trolley { color: #0984e3; }
        .icon-analytics { color: #00b894; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .stats-section, .recent-activities {
                grid-template-columns: 1fr;
            }
            
            .dashboard-header h1 {
                font-size: 2rem;
            }
            
            .header, .horizontal-menu {
                padding: 0 15px;
            }
            
            .menu-item {
                padding: 0 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo">
            <a href="index.html" style="text-decoration: none; color: inherit;">
                <i class="fas fa-tractor"></i>
                <span>Tractor Admin</span>
            </a>
        </div>
        
        <div class="time-display">
            <div id="current-time">11:45:32 AM</div>
            <div id="current-date">September 17, 2023</div>
        </div>
        
        <div class="admin-info">
            <div class="admin-details">
                <h3>
                    <i class="fas fa-user-shield"></i>
                    <span id="admin-text">Uttra Patel</span>
                </h3>
                <p>System Administrator</p>
            </div>
        </div>
    </div>
    
    <!-- Horizontal Menu -->
    <div class="horizontal-menu">
        <a href="admin-dashboard.html" class="menu-item active">
            <i class="fas fa-tachometer-alt"></i>
            <span>Dashboard</span>
        </a>
        <a href="admin-fleet.html" class="menu-item">
            <i class="fas fa-tractor"></i>
            <span>Fleet</span>
        </a>
        <a href="admin-diseal.html" class="menu-item">
            <i class="fas fa-gas-pump"></i>
            <span>Diesel</span>
        </a>
        <a href="admin-payment.html" class="menu-item">
            <i class="fas fa-money-bill-wave"></i>
            <span>Payment</span>
        </a>
        <a href="admin.html" class="menu-item">
            <i class="fas fa-cogs"></i>
            <span>Admin Data</span>
        </a>
        <div class="logout" id="logoutBtn">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="dashboard-container">
            <div class="dashboard-header">
                <h1><i class="fas fa-tractor"></i> Tractor Admin Dashboard</h1>
                <p>Advanced Fleet & Trolley Management System</p>
            </div>
            
            <!-- Stats Section -->
            <div class="stats-section">
                <div class="stats-column fleet-stats">
                    <h2 class="stats-column-title"><i class="fas fa-tractor"></i> Fleet Statistics</h2>
                    <div class="stat-item">
                        <div class="stat-label"><i class="fas fa-users"></i> Active Users</div>
                        <div class="stat-value loading" id="fleet-active-users">Loading...</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label"><i class="fas fa-tractor"></i> Active Fleet</div>
                        <div class="stat-value loading" id="fleet-active">Loading...</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label"><i class="fas fa-gas-pump"></i> Diesel (Fleet)</div>
                        <div class="stat-value loading" id="fleet-diesel">Loading...</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label"><i class="fas fa-money-bill-wave"></i> Total Fleet Revenue</div>
                        <div class="stat-value loading" id="fleet-revenue">Loading...</div>
                    </div>
                </div>
                
                <div class="stats-column trolley-stats">
                    <h2 class="stats-column-title"><i class="fas fa-truck-loading"></i> Trolley Statistics</h2>
                    <div class="stat-item">
                        <div class="stat-label"><i class="fas fa-users"></i> Active Users</div>
                        <div class="stat-value loading" id="trolley-active-users">Loading...</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label"><i class="fas fa-truck-loading"></i> Active Trolley</div>
                        <div class="stat-value loading" id="trolley-active">Loading...</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label"><i class="fas fa-gas-pump"></i> Diesel (Trolley)</div>
                        <div class="stat-value loading" id="trolley-diesel">Loading...</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label"><i class="fas fa-money-bill-wave"></i> Total Trolley Revenue</div>
                        <div class="stat-value loading" id="trolley-revenue">Loading...</div>
                    </div>
                </div>
            </div>
            
            <!-- Recent Activities Section -->
            <h2 class="section-title"><i class="fas fa-history"></i> Recent Activities</h2>
            <div class="recent-activities">
                <div class="activity-column">
                    <h3 class="stats-column-title"><i class="fas fa-tractor"></i> Fleet Activities</h3>
                    <div class="activity-list" id="fleet-activities">
                        <div class="activity-item">
                            <div class="activity-icon" style="background: var(--info);">
                                <i class="fas fa-sync-alt"></i>
                            </div>
                            <div class="activity-details">
                                <h4>Loading activities...</h4>
                                <p>Please wait while we fetch the latest activities</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="activity-column">
                    <h3 class="stats-column-title"><i class="fas fa-truck-loading"></i> Trolley Activities</h3>
                    <div class="activity-list" id="trolley-activities">
                        <div class="activity-item">
                            <div class="activity-icon" style="background: var(--info);">
                                <i class="fas fa-sync-alt"></i>
                            </div>
                            <div class="activity-details">
                                <h4>Loading activities...</h4>
                                <p>Please wait while we fetch the latest activities</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Quick Access Section -->
            <h2 class="section-title"><i class="fas fa-bolt"></i> Quick Access</h2>
            
            <!-- Operational Link Section -->
            <h3 class="section-title" style="font-size: 1.3rem; margin: 20px 0 15px;">Operational Link</h3>
            <div class="quick-access-grid">
                <a href="https://uttra-kumar.github.io/Supabase/" class="card-link">
                    <div class="card card-full card-highlight">
                        <i class="fas fa-database card-icon icon-database"></i>
                        <h3 class="card-title">Database Manager</h3>
                        <p class="card-description">Manage and monitor your entire database system with advanced tools and real-time analytics.</p>
                        <div class="card-access">Access Now <i class="fas fa-arrow-right"></i></div>
                    </div>
                </a>
                
                <a href="admin-alluser.html" class="card-link">
                    <div class="card card-full card-highlight">
                        <i class="fas fa-users card-icon icon-users"></i>
                        <h3 class="card-title">All User Management</h3>
                        <p class="card-description">View, manage, and analyze all user accounts with comprehensive user management tools.</p>
                        <div class="card-access">Access Now <i class="fas fa-arrow-right"></i></div>
                    </div>
                </a>
            </div>
            
            <!-- Trolley Ancestors Section (Moved Up) -->
            <h3 class="section-title" style="font-size: 1.3rem; margin: 20px 0 15px;">Trolley Ancestors</h3>
            <div class="quick-access-grid">
                <a href="admin-trolly.html" class="card-link">
                    <div class="card">
                        <i class="fas fa-truck-loading card-icon icon-trolley"></i>
                        <h3 class="card-title">Trolley Management</h3>
                        <p class="card-description">Complete trolley management system with advanced tracking and reporting features.</p>
                        <div class="card-access">Access Now <i class="fas fa-arrow-right"></i></div>
                    </div>
                </a>
                       
                <a href="paymentReg.html" class="card-link">
                    <div class="card card-full card-highlight">
                        <i class="fas fa-wallet card-icon icon-wallet"></i>
                        <h3 class="card-title">Payment Register</h3>
                        <p class="card-description">Comprehensive payment management system with tracking, reporting, and analytics.</p>
                        <div class="card-access">Access Now <i class="fas fa-arrow-right"></i></div>
                    </div>
                </a>


            </div>
            
            <!-- Operational Fleet Section -->
            <h3 class="section-title" style="font-size: 1.3rem; margin: 20px 0 15px;">Operational Fleet</h3>
            <div class="quick-access-grid">
                <a href="userFleet.html" class="card-link">
                    <div class="card">
                        <i class="fas fa-file-alt card-icon icon-file"></i>
                        <h3 class="card-title">User Fleet Entry</h3>
                        <p class="card-description">Add and manage fleet entries submitted by users with detailed tracking and reporting.</p>
                        <div class="card-access">Access Now <i class="fas fa-arrow-right"></i></div>
                    </div>
                </a>
                
                <a href="admin-f&PP.html" class="card-link">
                    <div class="card">
                        <i class="fas fa-filter card-icon icon-filter"></i>
                        <h3 class="card-title">Admin Fleet Management</h3>
                        <p class="card-description">Advanced fleet management with filtering, analytics, and comprehensive oversight tools.</p>
                        <div class="card-access">Access Now <i class="fas fa-arrow-right"></i></div>
                    </div>
                </a>
            </div>
            
            <!-- Operational Trolley Section -->
            <h3 class="section-title" style="font-size: 1.3rem; margin: 20px 0 15px;">Operational Trolley</h3>
            <div class="quick-access-grid">
                <a href="userTrolly.html" class="card-link">
                    <div class="card">
                        <i class="fas fa-truck card-icon icon-truck"></i>
                        <h3 class="card-title">User Trolley Entry</h3>
                        <p class="card-description">Manage trolley entries submitted by users with real-time tracking and reporting.</p>
                        <div class="card-access">Access Now <i class="fas fa-arrow-right"></i></div>
                    </div>
                </a>
                
                <a href="admin-trollyFil.html" class="card-link">
                    <div class="card">
                        <i class="fas fa-sliders card-icon icon-sliders"></i>
                        <h3 class="card-title">Trolley Filtration</h3>
                        <p class="card-description">Advanced filtering and analytics for trolley operations with comprehensive reporting.</p>
                        <div class="card-access">Access Now <i class="fas fa-arrow-right"></i></div>
                    </div>
                </a>
            </div>
            
            <!-- Operational Filter Section -->
            <h3 class="section-title" style="font-size: 1.3rem; margin: 20px 0 15px;">Operational Filter</h3>
            <div class="quick-access-grid">
                <a href="adminfilter.html" class="card-link">
                    <div class="card">
                        <i class="fas fa-sliders-h card-icon icon-sliders"></i>
                        <h3 class="card-title">Admin Filter</h3>
                        <p class="card-description">Advanced filtering system for comprehensive data analysis and management.</p>
                        <div class="card-access">Access Now <i class="fas fa-arrow-right"></i></div>
                    </div>
                </a>
                
                <a href="admintrollyfilter.html" class="card-link">
                    <div class="card">
                        <i class="fas fa-dolly-flatbed card-icon icon-dolly"></i>
                        <h3 class="card-title">Trolley Day-wise Filtration</h3>
                        <p class="card-description">Filter and analyze trolley data by specific days with detailed reporting.</p>
                        <div class="card-access">Access Now <i class="fas fa-arrow-right"></i></div>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2025 Tractor Fleet Management || Designed By <span>Uttra Patel</span><br />
                <p1>session expired is <span id="counter">0s</span></p1>
            </p>
        </div>
    </footer>
<script src="session.js" type="text/javascript" charset="utf-8"></script>
    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://iydamvrlxtwsnqvflaxq.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml5ZGFtdnJseHR3c25xdmZsYXhxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwOTczMTIsImV4cCI6MjA3MzY3MzMxMn0.Z8m6XGyu9wsN_UJ8EZYr12BRemsO12_U8EEZ9JizQ6w';
        
        // Initialize Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        // DOM Elements
        const currentTime = document.getElementById('current-time');
        const currentDate = document.getElementById('current-date');
        const fleetActiveUsers = document.getElementById('fleet-active-users');
        const fleetActive = document.getElementById('fleet-active');
        const fleetDiesel = document.getElementById('fleet-diesel');
        const fleetRevenue = document.getElementById('fleet-revenue');
        const trolleyActiveUsers = document.getElementById('trolley-active-users');
        const trolleyActive = document.getElementById('trolley-active');
        const trolleyDiesel = document.getElementById('trolley-diesel');
        const trolleyRevenue = document.getElementById('trolley-revenue');
        const fleetActivities = document.getElementById('fleet-activities');
        const trolleyActivities = document.getElementById('trolley-activities');
        const counter = document.getElementById('counter');
        
        // Initialize Dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize time display
            updateTime();
            setInterval(updateTime, 1000);
            
            // Initialize session counter
            
            
            // Load dashboard data
            loadDashboardData();
            
            // Load recent activities
            loadRecentActivities();
        });
        
        // Update Time Function
        function updateTime() {
            const now = new Date();
            const time = now.toLocaleTimeString('en-US', { hour12: true });
            const date = now.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            currentTime.textContent = time;
            currentDate.textContent = date;
        }
        
        // 
        
        // Load Dashboard Data from Supabase
        async function loadDashboardData() {
            try {
                // Load Fleet Statistics
                await loadFleetStats();
                
                // Load Trolley Statistics
                await loadTrolleyStats();
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                setFallbackValues();
            }
        }
        
        // Load Fleet Statistics
        async function loadFleetStats() {
            try {
                // Active Users Count
                const { count: activeUsersCount, error: usersError } = await supabase
                    .from('userRegistration-T')
                    .select('*', { count: 'exact', head: true });
                
                if (!usersError) {
                    fleetActiveUsers.textContent = activeUsersCount || 0;
                    fleetActiveUsers.classList.remove('loading');
                } else {
                    throw new Error('Failed to fetch users data');
                }
                
                // Active Fleet (total running time)
                const { data: fleetData, error: fleetError } = await supabase
                    .from('admin-fleet')
                    .select('running_time');
                
                if (!fleetError && fleetData) {
                    const totalRunningTime = fleetData.reduce(
                        (sum, item) => sum + (parseInt(item.running_time) || 0),
                        0
                    );
                    fleetActive.textContent = totalRunningTime + ' Min';
                    fleetActive.classList.remove('loading');
                } else {
                    throw new Error('Failed to fetch fleet data');
                }
                
                // Diesel for Fleet (category = 'fleet')
                const { data: dieselData, error: dieselError } = await supabase
                    .from('admin-diseal')
                    .select('amount, category')
                    .eq('category', 'Fleet');
                
                if (!dieselError && dieselData) {
                    const totalDiesel = dieselData.reduce(
                        (sum, item) => sum + (parseInt(item.amount) || 0),
                        0
                    );
                    fleetDiesel.textContent = '₹' + totalDiesel;
                    fleetDiesel.classList.remove('loading');
                } else {
                    throw new Error('Failed to fetch diesel data');
                }
                
                // Total Fleet Revenue
                const { data: paymentData, error: paymentError } = await supabase
                    .from('admin-payment')
                    .select('amount');
                
                if (!paymentError && paymentData) {
                    const totalRevenue = paymentData.reduce(
                        (sum, item) => sum + (parseFloat(item.amount) || 0),
                        0
                    );
                    fleetRevenue.textContent = '₹' + totalRevenue;
                    fleetRevenue.classList.remove('loading');
                } else {
                    throw new Error('Failed to fetch payment data');
                }
                
            } catch (error) {
                console.error('Error loading fleet stats:', error);
                setFleetFallbackValues();
            }
        }
        
        // Load Trolley Statistics
        async function loadTrolleyStats() {
            try {
                // Active Users Count (same as fleet for now)
                const { count: activeUsersCount, error: usersError } = await supabase
                    .from('userReg_T')
                    .select('*', { count: 'exact', head: true });
                
                if (!usersError) {
                    trolleyActiveUsers.textContent = activeUsersCount || 0;
                    trolleyActiveUsers.classList.remove('loading');
                } else {
                    throw new Error('Failed to fetch users data');
                }
                
                // Active Trolley (total trolley count)
                const { data: trollyData, error: trollyError } = await supabase
                    .from('admin-trolly')
                    .select('trolley');
                
                if (!trollyError && trollyData) {
                    const totalTrolley = trollyData.reduce(
                        (sum, item) => sum + (parseInt(item.trolley) || 0),
                        0
                    );
                    trolleyActive.textContent = totalTrolley + ' T';
                    trolleyActive.classList.remove('loading');
                } else {
                    throw new Error('Failed to fetch trolley data');
                }
                
                // Diesel for Trolley (category = 'trolley')
                const { data: dieselData, error: dieselError } = await supabase
                    .from('admin-diseal')
                    .select('amount, category')
                    .eq('category', 'Trolley');
                
                if (!dieselError && dieselData) {
                    const totalDiesel = dieselData.reduce(
                        (sum, item) => sum + (parseInt(item.amount) || 0),
                        0
                    );
                    trolleyDiesel.textContent = '₹' + totalDiesel;
                    trolleyDiesel.classList.remove('loading');
                } else {
                    throw new Error('Failed to fetch trolley diesel data');
                }
                
                // Total Trolley Revenue
                const { data: trollyPaymentData, error: trollyPaymentError } = await supabase
                    .from('admin-trollypay')
                    .select('amount');
                
                if (!trollyPaymentError && trollyPaymentData) {
                    const totalRevenue = trollyPaymentData.reduce(
                        (sum, item) => sum + (parseFloat(item.amount) || 0),
                        0
                    );
                    trolleyRevenue.textContent = '₹' + totalRevenue;
                    trolleyRevenue.classList.remove('loading');
                } else {
                    throw new Error('Failed to fetch trolley payment data');
                }
                
            } catch (error) {
                console.error('Error loading trolley stats:', error);
                setTrolleyFallbackValues();
            }
        }
        
        // Load Recent Activities (Fixed Implementation)
        async function loadRecentActivities() {
            try {
                const fleetActivitiesList = [];
                const trolleyActivitiesList = [];
                
                // Fetch recent user registrations
                const { data: usersData, error: usersError } = await supabase
                    .from('userRegistration-T')
                    .select('name, created_at')
                    .order('created_at', { ascending: false })
                    .limit(2);
                
                if (!usersError && usersData) {
                    usersData.forEach(user => {
                        fleetActivitiesList.push({
                            type: 'user',
                            title: 'New User Registration',
                            description: `${user.name} registered as a new user`,
                            timestamp: user.created_at,
                            icon: 'user-plus',
                            color: 'success'
                        });
                    });
                }
                
                // Fetch recent fleet entries
                const { data: fleetData, error: fleetError } = await supabase
                    .from('userFleet')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(2);
                
                if (!fleetError && fleetData) {
                    fleetData.forEach(fleet => {
                        fleetActivitiesList.push({
                            type: 'fleet',
                            title: 'New Fleet Entry',
                            description: `${fleet.runningtime} Minutes for ${fleet.user_id} ${fleet.name}`,
                            timestamp: fleet.created_at,
                            icon: 'tractor',
                            color: 'primary'
                        });
                    });
                }
                
                // Fetch recent diesel entries for fleet
                const { data: fleetDieselData, error: fleetDieselError } = await supabase
                    .from('admin-diseal')
                    .select('*')
                    .eq('category', 'Fleet')
                    .order('created_at', { ascending: false })
                    .limit(1);
                
                if (!fleetDieselError && fleetDieselData) {
                    fleetDieselData.forEach(diesel => {
                        fleetActivitiesList.push({
                            type: 'diesel',
                            title: 'Fleet Diesel Refill',
                            description: `₹${diesel.amount} diesel added by ${diesel.name}`,
                            timestamp: diesel.created_at,
                            icon: 'gas-pump',
                            color: 'warning'
                        });
                    });
                }
                
                // Fetch recent payments for fleet
                const { data: paymentData, error: paymentError } = await supabase
                    .from('admin-payment')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(1);
                
                if (!paymentError && paymentData) {
                    paymentData.forEach(payment => {
                        fleetActivitiesList.push({
                            type: 'payment',
                            title: 'Payment Received',
                            description: `Payment of ₹${payment.paid_amount} of ${payment.total_amount} from ${payment.name}`,
                            timestamp: payment.created_at,
                            icon: 'money-bill-wave',
                            color: 'info'
                        });
                    });
                }
                
                // Fetch recent trolley entries
                const { data: trollyData, error: trollyError } = await supabase
                    .from('admin-trolly')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(2);
                
                if (!trollyError && trollyData) {
                    trollyData.forEach(trolley => {
                        trolleyActivitiesList.push({
                            type: 'trolley',
                            title: 'New Trolley Entry',
                            description: `${trolley.trolley} trolleys added`,
                            timestamp: trolley.created_at,
                            icon: 'truck-loading',
                            color: 'success'
                        });
                    });
                }
                
                // Fetch recent diesel entries for trolley
                const { data: trolleyDieselData, error: trolleyDieselError } = await supabase
                    .from('admin-diseal')
                    .select('*')
                    .eq('category', 'Trolley')
                    .order('created_at', { ascending: false })
                    .limit(1);
                
                if (!trolleyDieselError && trolleyDieselData) {
                    trolleyDieselData.forEach(diesel => {
                        trolleyActivitiesList.push({
                            type: 'diesel',
                            title: 'Trolley Diesel Refill',
                            description: `₹${diesel.amount} diesel added for trolley`,
                            timestamp: diesel.created_at,
                            icon: 'gas-pump',
                            color: 'warning'
                        });
                    });
                }
                
                // Fetch recent trolley payments
                const { data: trolleyPaymentData, error: trolleyPaymentError } = await supabase
                    .from('admin-trollypay')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(1);
                
                if (!trolleyPaymentError && trolleyPaymentData) {
                    trolleyPaymentData.forEach(payment => {
                        trolleyActivitiesList.push({
                            type: 'payment',
                            title: 'Trolley Payment',
                            description: `Payment of ₹${payment.amount} received`,
                            timestamp: payment.created_at,
                            icon: 'money-bill-wave',
                            color: 'info'
                        });
                    });
                }
                
                // Sort activities by timestamp (newest first)
                fleetActivitiesList.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                trolleyActivitiesList.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                // Take only the 3 most recent activities for each
                const displayFleetActivities = fleetActivitiesList.slice(0, 3);
                const displayTrolleyActivities = trolleyActivitiesList.slice(0, 3);
                
                // Update the DOM
                updateActivitiesDOM(displayFleetActivities, fleetActivities);
                updateActivitiesDOM(displayTrolleyActivities, trolleyActivities);
                
            } catch (error) {
                console.error('Error loading recent activities:', error);
                fleetActivities.innerHTML = `
                    <div class="activity-item">
                        <div class="activity-icon" style="background: var(--accent);">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="activity-details">
                            <h4>Error loading activities</h4>
                            <p>Please try refreshing the page</p>
                        </div>
                    </div>
                `;
                trolleyActivities.innerHTML = fleetActivities.innerHTML;
            }
        }
        
        // Update Activities DOM
        function updateActivitiesDOM(activities, container) {
            if (activities.length === 0) {
                container.innerHTML = `
                    <div class="activity-item">
                        <div class="activity-icon" style="background: var(--info);">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="activity-details">
                            <h4>No recent activities</h4>
                            <p>Activities will appear here as they happen</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = activities.map(activity => {
                const timeAgo = getTimeAgo(activity.timestamp);
                const color = getColorValue(activity.color);
                
                return `
                    <div class="activity-item">
                        <div class="activity-icon" style="background: ${color};">
                            <i class="fas fa-${activity.icon}"></i>
                        </div>
                        <div class="activity-details">
                            <h4>${activity.title}</h4>
                            <p>${activity.description}</p>
                        </div>
                        <div class="activity-time">${timeAgo}</div>
                    </div>
                `;
            }).join('');
        }
        
        // Get Color Value from CSS Variable
        function getColorValue(colorName) {
            const root = document.documentElement;
            return getComputedStyle(root).getPropertyValue(`--${colorName}`).trim();
        }
        
        // Calculate Time Ago
        function getTimeAgo(timestamp) {
            if (!timestamp) return 'Unknown time';
            
            const now = new Date();
            const activityTime = new Date(timestamp);
            const diffInSeconds = Math.floor((now - activityTime) / 1000);
            
            if (diffInSeconds < 60) {
                return 'Just now';
            } else if (diffInSeconds < 3600) {
                const minutes = Math.floor(diffInSeconds / 60);
                return `${minutes} min ago`;
            } else if (diffInSeconds < 86400) {
                const hours = Math.floor(diffInSeconds / 3600);
                return `${hours} hour${hours > 1 ? 's' : ''} ago`;
            } else if (diffInSeconds < 604800) {
                const days = Math.floor(diffInSeconds / 86400);
                return `${days} day${days > 1 ? 's' : ''} ago`;
            } else {
                return activityTime.toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric'
                });
            }
        }
        
        // Set Fallback Values for Fleet
        function setFleetFallbackValues() {
            fleetActiveUsers.textContent = '245';
            fleetActive.textContent = '42 Min';
            fleetDiesel.textContent = '₹12,500';
            fleetRevenue.textContent = '₹125,000';
            
            fleetActiveUsers.classList.remove('loading');
            fleetActive.classList.remove('loading');
            fleetDiesel.classList.remove('loading');
            fleetRevenue.classList.remove('loading');
        }
        
        // Set Fallback Values for Trolley
        function setTrolleyFallbackValues() {
            trolleyActiveUsers.textContent = '189';
            trolleyActive.textContent = '36 T';
            trolleyDiesel.textContent = '₹8,750';
            trolleyRevenue.textContent = '₹98,500';
            
            trolleyActiveUsers.classList.remove('loading');
            trolleyActive.classList.remove('loading');
            trolleyDiesel.classList.remove('loading');
            trolleyRevenue.classList.remove('loading');
        }
        
        // Set All Fallback Values
        function setFallbackValues() {
            setFleetFallbackValues();
            setTrolleyFallbackValues();
        }
    </script>
</body>
</html>
